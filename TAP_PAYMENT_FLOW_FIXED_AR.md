# ๐ง ุฅุตูุงุญ ูุดููุฉ ุทูุจุงุช Tap - ุงูุญู ุงูููุงุฆู

## ๐ด ุงููุดููุฉ ุงููุจูุฑุฉ

**ุงูุทูุจ ูููุดุฃ ููุธูุฑ ูู ููุญุฉ ุงูุชุญูู ูุจู ุฃู ูุฏูุน ุงูุนููู!**

ูุฐุง ูุนูู:
- โ ุทูุจุงุช ููููุฉ ูู ุงููุธุงู
- โ ุงูุนููู ููููู ุฅุบูุงู ุตูุญุฉ ุงูุฏูุน ูุงูุทูุจ ูุจูู
- โ ุตุนูุจุฉ ุชุชุจุน ุงูุทูุจุงุช ุงูุญููููุฉ

## โ ุงูุญู ุงูุตุญูุญ

### 1. ูุธุงู ุงูุญุงูุงุช (Status System)

```typescript
// ุญุงูุงุช ุงูุทูุจ
DRAFT     โ ุทูุจ ูุณูุฏุฉ (ูู ูุชู ุงูุฏูุน ุจุนุฏ)
PENDING   โ ุทูุจ ูุคูุฏ (ุชู ุงูุฏูุน ุฃู COD)
PROCESSING โ ููุฏ ุงููุนุงูุฌุฉ
SHIPPED   โ ุชู ุงูุดุญู
DELIVERED โ ุชู ุงูุชูุตูู
CANCELLED โ ููุบู
```

### 2. ุณูุฑ ุงูุนูู ุงูุฌุฏูุฏ

#### ููุฏูุน ุนูุฏ ุงูุงุณุชูุงู (COD):
```
1. ุฅูุดุงุก ุทูุจ ุจุญุงูุฉ PENDING โ
2. ูุณุญ ุงูุณูุฉ ููุฑุงู โ
3. ุนุฑุถ ุตูุญุฉ ุงููุฌุงุญ โ
```

#### ููุฏูุน ุนุจุฑ Tap:
```
1. ุฅูุดุงุก ุทูุจ ุจุญุงูุฉ DRAFT ๐
2. ุชูุฌูู ุงูุนููู ูุตูุญุฉ ุงูุฏูุน ๐ณ
3. ุงูุนููู ูุฏูุน โ
4. Callback: ุชุญุฏูุซ ุงูุทูุจ ุฅูู PENDING โ
5. ูุณุญ ุงูุณูุฉ โ
6. ุนุฑุถ ุตูุญุฉ ุงููุฌุงุญ โ
```

#### ุฅุฐุง ูุดู ุงูุฏูุน ุฃู ุฃูุบู ุงูุนููู:
```
1. ุงูุทูุจ ูุจูู ุจุญุงูุฉ DRAFT ๐
2. ุงูุณูุฉ ุชุจูู ููุฌูุฏุฉ ๐
3. ุงูุนููู ููููู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู ๐
```

## ๐ ุงูุชุบููุฑุงุช ุงููุทููุจุฉ

### Frontend (ุชู โ)

#### 1. ูู `checkout/page.tsx`:
```typescript
const orderPayload = {
  // ... ุจุงูู ุงูุจูุงูุงุช
  status: selectedPayment === 'tap' ? 'DRAFT' : 'PENDING',
  isDraft: selectedPayment === 'tap',
}
```

#### 2. ูู `payment/callback/page.tsx`:
```typescript
// ุจุนุฏ ุงูุชุญูู ูู ูุฌุงุญ ุงูุฏูุน
await fetch(`${API_URL}/orders/${orderId}/confirm`, {
  method: 'POST',
  // ุชุญุฏูุซ ุงูุญุงูุฉ ูู DRAFT ุฅูู PENDING
})
```

### Backend (ูุญุชุงุฌ ุชุทุจูู โ๏ธ)

#### 1. ูู `orderController.ts`:
```typescript
// POST /api/orders
const order = await prisma.order.create({
  data: {
    // ... ุงูุจูุงูุงุช
    status: req.body.status || 'PENDING',
    paymentStatus: req.body.isDraft ? 'PENDING' : 'PENDING',
  }
})
```

#### 2. ุฅุถุงูุฉ endpoint ุฌุฏูุฏ:
```typescript
// POST /api/orders/:id/confirm
// ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ ูู DRAFT ุฅูู PENDING ุจุนุฏ ูุฌุงุญ ุงูุฏูุน
router.post('/orders/:id/confirm', async (req, res) => {
  const order = await prisma.order.update({
    where: { id: req.params.id },
    data: {
      status: 'PENDING',
      paymentStatus: 'COMPLETED',
      updatedAt: new Date()
    }
  })
  
  res.json({ success: true, order })
})
```

#### 3. ูู ููุญุฉ ุงูุชุญูู:
```typescript
// GET /api/orders/admin/all
// ุนุฏู ุนุฑุถ ุงูุทูุจุงุช ุจุญุงูุฉ DRAFT
const orders = await prisma.order.findMany({
  where: {
    status: { not: 'DRAFT' } // ุฅุฎูุงุก ุงููุณูุฏุงุช
  }
})
```

#### 4. ูููุฉ ุชูุธูู (Cleanup Job):
```typescript
// ุญุฐู ุงูุทูุจุงุช ุงููุณูุฏุฉ ุงููุฏููุฉ (ุฃูุซุฑ ูู 24 ุณุงุนุฉ)
async function cleanupDraftOrders() {
  const yesterday = new Date()
  yesterday.setDate(yesterday.getDate() - 1)
  
  await prisma.order.deleteMany({
    where: {
      status: 'DRAFT',
      createdAt: { lt: yesterday }
    }
  })
}

// ุชุดุบูู ูู 6 ุณุงุนุงุช
setInterval(cleanupDraftOrders, 6 * 60 * 60 * 1000)
```

## ๐ฏ ุงููุชูุฌุฉ ุงููุชููุนุฉ

### ูุจู ุงูุฅุตูุงุญ โ:
```
1. ุงูุนููู ูุถุบุท "ุฅุชูุงู ุงูุทูุจ"
2. ุงูุทูุจ ูููุดุฃ ููุธูุฑ ูู ููุญุฉ ุงูุชุญูู
3. ุงูุนููู ูููุฌู ูุตูุญุฉ ุงูุฏูุน
4. ุงูุนููู ูุบูู ุงูุตูุญุฉ ุจุฏูู ุฏูุน
5. ุงูุทูุจ ูุจูู ูู ุงููุธุงู! โ
```

### ุจุนุฏ ุงูุฅุตูุงุญ โ:
```
1. ุงูุนููู ูุถุบุท "ุฅุชูุงู ุงูุทูุจ"
2. ุงูุทูุจ ูููุดุฃ ููุณูุฏุฉ (DRAFT)
3. ุงูุนููู ูููุฌู ูุตูุญุฉ ุงูุฏูุน
4. ุงูุนููู ูุฏูุน ุจูุฌุงุญ โ
5. ุงูุทูุจ ูุชุญูู ุฅูู PENDING ููุธูุฑ ูู ููุญุฉ ุงูุชุญูู โ
```

### ุฅุฐุง ูู ูุฏูุน:
```
1. ุงูุทูุจ ูุจูู DRAFT (ูุฎูู ูู ููุญุฉ ุงูุชุญูู)
2. ุงูุณูุฉ ุชุจูู ููุฌูุฏุฉ
3. ุจุนุฏ 24 ุณุงุนุฉ: ุงูุทูุจ ููุญุฐู ุชููุงุฆูุงู
```

## ๐ ููุงุฑูุฉ ุงูุญุงูุงุช

| ุงูุญุงูุฉ | ุงููุตู | ูุธูุฑ ูู ููุญุฉ ุงูุชุญููุ | ุงูุณูุฉ |
|--------|-------|---------------------|-------|
| **DRAFT** | ูุณูุฏุฉ - ูู ูุชู ุงูุฏูุน | โ ูุง | โ ููุฌูุฏุฉ |
| **PENDING** | ูุคูุฏ - ุชู ุงูุฏูุน ุฃู COD | โ ูุนู | โ ููุณูุญุฉ |
| **PROCESSING** | ููุฏ ุงููุนุงูุฌุฉ | โ ูุนู | โ ููุณูุญุฉ |
| **SHIPPED** | ุชู ุงูุดุญู | โ ูุนู | โ ููุณูุญุฉ |
| **DELIVERED** | ุชู ุงูุชูุตูู | โ ูุนู | โ ููุณูุญุฉ |

## ๐ง ุฎุทูุงุช ุงูุชุทุจูู

### 1. Frontend (ุชู โ)
- [x] ุชุญุฏูุซ `checkout/page.tsx`
- [x] ุชุญุฏูุซ `payment/callback/page.tsx`
- [x] ุฅุถุงูุฉ `status` ู `isDraft` ููุทูุจ

### 2. Backend (ูุญุชุงุฌ ุชุทุจูู โ๏ธ)
- [ ] ุชุญุฏูุซ `orderController.ts` ูุฏุนู DRAFT
- [ ] ุฅุถุงูุฉ endpoint `/orders/:id/confirm`
- [ ] ุชุญุฏูุซ `/orders/admin/all` ูุฅุฎูุงุก DRAFT
- [ ] ุฅุถุงูุฉ ูููุฉ ุชูุธูู ุงููุณูุฏุงุช ุงููุฏููุฉ

### 3. Database (ูุญุชุงุฌ ุชุทุจูู โ๏ธ)
- [ ] ุงูุชุฃูุฏ ูู ุฃู `status` ูุฏุนู DRAFT ูู schema
- [ ] ุฅุถุงูุฉ index ุนูู `status` ููุฃุฏุงุก

## ๐ก ูุตุงุฆุญ ุฅุถุงููุฉ

### 1. ุฅุดุนุงุฑุงุช ููุฅุฏุงุฑุฉ
```typescript
// ุนูุฏ ุชุญููู ุงูุทูุจ ูู DRAFT ุฅูู PENDING
sendAdminNotification({
  title: 'ุทูุจ ุฌุฏูุฏ',
  message: `ุชู ุงุณุชูุงู ุทูุจ ุฌุฏูุฏ #${orderNumber}`,
  orderId
})
```

### 2. ุชูุฑูุฑ ุงูุทูุจุงุช ุงูููุฌูุฑุฉ
```typescript
// ุนุฑุถ ุงูุทูุจุงุช DRAFT ููุฅุฏุงุฑุฉ (ููุชุญููู)
GET /api/orders/admin/abandoned
// ูุนุฑุถ ุงูุทูุจุงุช ุงูุชู ูู ุชูุชูู
```

### 3. ุฅุนุงุฏุฉ ุงููุญุงููุฉ ููุนููู
```typescript
// ูู ุตูุญุฉ "ุทูุจุงุชู"
// ุนุฑุถ ุงูุทูุจุงุช DRAFT ูุน ุฒุฑ "ุฅููุงู ุงูุฏูุน"
if (order.status === 'DRAFT') {
  <button onClick={() => retryPayment(order.id)}>
    ุฅููุงู ุงูุฏูุน
  </button>
}
```

## โ ูุงุฆูุฉ ุงูุชุญูู

- [x] Frontend: ุฅูุดุงุก ุทูุจ DRAFT ููู Tap
- [x] Frontend: ูุณุญ ุงูุณูุฉ ููุท ุจุนุฏ ูุฌุงุญ ุงูุฏูุน
- [x] Frontend: ุตูุญุฉ callback ููุชุญูู
- [ ] Backend: ุฏุนู ุญุงูุฉ DRAFT
- [ ] Backend: endpoint ูุชุฃููุฏ ุงูุทูุจ
- [ ] Backend: ุฅุฎูุงุก DRAFT ูู ููุญุฉ ุงูุชุญูู
- [ ] Backend: ูููุฉ ุชูุธูู ุงููุณูุฏุงุช
- [ ] Testing: ุงุฎุชุจุงุฑ ุงูุณููุงุฑูููุงุช ุงููุฎุชููุฉ

---

**ุชู ุงูุชุญุฏูุซ**: 30 ููููุจุฑ 2025  
**ุงูุญุงูุฉ**: Frontend โ | Backend โ๏ธ ูุญุชุงุฌ ุชุทุจูู  
**ุงูุฃููููุฉ**: ๐ด ุนุงููุฉ ุฌุฏุงู
