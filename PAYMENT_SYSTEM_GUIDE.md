# ๐ณ ุฏููู ูุธุงู ุงูุฏูุน - Payment System Guide

## โ ุงูุญุงูุฉ ุงูุญุงููุฉ

### ูุง ุชู ุฅูุฌุงุฒู:
- โ Backend API ููุฏูุน (Payment Controller)
- โ Frontend ุตูุญุฉ ุงูุฏูุน (Checkout Page)
- โ ุตูุญุฉ ุฅุนุฏุงุฏุงุช ุงูุฏูุน ููู Admin
- โ ุฏุนู 5 ุทุฑู ุฏูุน:
  - ๐ต ุงูุฏูุน ุนูุฏ ุงูุงุณุชูุงู (COD) - **ููุนูู**
  - ๐ณ Tap Payment - ูุนุทูู (ูุญุชุงุฌ API Keys)
  - ๐ฐ MyFatoorah - ูุนุทูู (ูุญุชุงุฌ API Keys)
  - ๐๏ธ Tamara - ูุนุทูู (ูุญุชุงุฌ API Keys)
  - ๐ฆ Tabby - ูุนุทูู (ูุญุชุงุฌ API Keys)

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุชุดุบูู ุงููุดุฑูุน

```bash
# Backend (ูู terminal ูููุตู)
cd backend
npm run dev

# Frontend (ูู terminal ูููุตู)
cd frontend
npm run dev
```

**ุงูุฑูุงุจุท:**
- Frontend: http://localhost:3000
- Backend API: http://localhost:4000
- Admin Panel: http://localhost:3000/admin

---

### 2. ุงุฎุชุจุงุฑ ูุธุงู ุงูุฏูุน

#### ุฃ) ูุนููู (Customer):

1. **ุชุตูุญ ุงูููุชุฌุงุช:**
   - ุงูุชุญ: http://localhost:3000
   - ุงุฎุชุฑ ููุชุฌ ูุฃุถูู ููุณูุฉ

2. **ุฅุชูุงู ุงูุทูุจ:**
   - ุงุฐูุจ ููุณูุฉ: http://localhost:3000/cart
   - ุงุถุบุท "ุฅุชูุงู ุงูุทูุจ"
   - ุณุชูุชูู ูุตูุญุฉ ุงูุฏูุน: http://localhost:3000/checkout

3. **ุงุฎุชูุงุฑ ุทุฑููุฉ ุงูุฏูุน:**
   - ุญุงููุงู ููุท "ุงูุฏูุน ุนูุฏ ุงูุงุณุชูุงู" ูุชุงุญ
   - ุงููุฃ ุจูุงูุงุช ุงูุดุญู
   - ุงุถุบุท "ุชุฃููุฏ ุงูุทูุจ"

#### ุจ) ููุฏูุฑ (Admin):

1. **ุชุณุฌูู ุงูุฏุฎูู:**
   - ุงูุชุญ: http://localhost:3000/admin/login
   - ุงุณุชุฎุฏู ุญุณุงุจ Admin

2. **ุฅุนุฏุงุฏุงุช ุงูุฏูุน:**
   - ุงุฐูุจ ุฅูู: http://localhost:3000/admin/settings/payment
   - ุณุชุฌุฏ ูุงุฆูุฉ ุจุทุฑู ุงูุฏูุน
   - ููููู ุชูุนูู/ุชุนุทูู ุฃู ุทุฑููุฉ
   - ููููู ุฅุถุงูุฉ API Keys ููู ุทุฑููุฉ

---

## ๐ง ุชูุนูู ุทุฑู ุงูุฏูุน ุงูุฅููุชุฑูููุฉ

### Tap Payment

1. ุณุฌู ูู: https://www.tap.company
2. ุงุญุตู ุนูู:
   - Secret Key
   - Public Key
3. ูู Admin Panel โ Payment Settings:
   - ุงูุชุญ ุจุทุงูุฉ "Tap Payment"
   - ุฃุฏุฎู ุงูููุงุชูุญ
   - ูุนูู "ูุถุน ุงูุงุฎุชุจุงุฑ" ููุชุฌุฑุจุฉ
   - ุงุญูุธ ุงูุชุบููุฑุงุช
   - ูุนูู ุงูุทุฑููุฉ

### MyFatoorah

1. ุณุฌู ูู: https://myfatoorah.com
2. ุงุญุตู ุนูู API Key
3. ูู Admin Panel โ Payment Settings:
   - ุงูุชุญ ุจุทุงูุฉ "MyFatoorah"
   - ุฃุฏุฎู API Key
   - ูุนูู "ูุถุน ุงูุงุฎุชุจุงุฑ"
   - ุงุญูุธ ููุนูู

### Tamara

1. ุณุฌู ูู: https://tamara.co
2. ุงุญุตู ุนูู:
   - API Token
   - Merchant ID
3. ูู Admin Panel โ Payment Settings:
   - ุงูุชุญ ุจุทุงูุฉ "Tamara"
   - ุฃุฏุฎู ุงูุจูุงูุงุช
   - ุงุญูุธ ููุนูู

### Tabby

1. ุณุฌู ูู: https://tabby.ai
2. ุงุญุตู ุนูู:
   - Public Key
   - Secret Key
   - Merchant Code
3. ูู Admin Panel โ Payment Settings:
   - ุงูุชุญ ุจุทุงูุฉ "Tabby"
   - ุฃุฏุฎู ุงูุจูุงูุงุช
   - ุงุญูุธ ููุนูู

---

## ๐ ูููุงุช ุงููุธุงู

### Backend:
```
backend/
โโโ src/
โ   โโโ controllers/
โ   โ   โโโ paymentController.ts       # ูุนุงูุฌุฉ ุทูุจุงุช ุงูุฏูุน
โ   โโโ services/
โ   โ   โโโ PaymentService.ts          # ุฎุฏูุฉ ุงูุฏูุน ุงูุฑุฆูุณูุฉ
โ   โ   โโโ paymentProviders/          # ูุฒูุฏู ุงูุฏูุน
โ   โ       โโโ TapPaymentService.ts
โ   โ       โโโ MyFatoorahService.ts
โ   โ       โโโ TamaraService.ts
โ   โ       โโโ TabbyService.ts
โ   โโโ routes/
โ   โ   โโโ payments.ts                # ูุณุงุฑุงุช API
โ   โโโ types/
โ       โโโ payment.ts                 # ุฃููุงุน TypeScript
โโโ init-payment-settings.ts           # ุชููุฆุฉ ุงูุจูุงูุงุช
```

### Frontend:
```
frontend/src/
โโโ app/
โ   โโโ checkout/
โ   โ   โโโ page.tsx                   # ุตูุญุฉ ุงูุฏูุน
โ   โโโ admin/
โ       โโโ settings/
โ           โโโ payment/
โ               โโโ page.tsx           # ุฅุนุฏุงุฏุงุช ุงูุฏูุน
```

---

## ๐ API Endpoints

### Public:
- `GET /api/payments/methods` - ูุงุฆูุฉ ุทุฑู ุงูุฏูุน ุงููุชุงุญุฉ
- `GET /api/payments/callback` - ุงุณุชูุจุงู ูุชูุฌุฉ ุงูุฏูุน
- `POST /api/payments/webhook/tap` - Webhook ูู Tap
- `POST /api/payments/webhook/tamara` - Webhook ูู Tamara

### Protected (ูุญุชุงุฌ ุชุณุฌูู ุฏุฎูู):
- `POST /api/payments/create` - ุฅูุดุงุก ุนูููุฉ ุฏูุน
- `GET /api/payments/verify/:provider/:transactionId` - ุงูุชุญูู ูู ุงูุฏูุน

### Admin Only:
- `GET /api/payments/settings` - ุฌูุจ ุฅุนุฏุงุฏุงุช ุงูุฏูุน
- `PUT /api/payments/settings` - ุชุญุฏูุซ ุฅุนุฏุงุฏุงุช ุงูุฏูุน

---

## ๐งช ุงุฎุชุจุงุฑ ุงููุธุงู

### 1. ุงุฎุชุจุงุฑ ุงูุฏูุน ุนูุฏ ุงูุงุณุชูุงู (COD):

```bash
# 1. ุฃุถู ููุชุฌ ููุณูุฉ
# 2. ุงุฐูุจ ููู Checkout
# 3. ุงุฎุชุฑ "ุงูุฏูุน ุนูุฏ ุงูุงุณุชูุงู"
# 4. ุงููุฃ ุงูุจูุงูุงุช ูุฃููู ุงูุทูุจ
# โ ูุฌุจ ุฃู ูุชู ุฅูุดุงุก ุงูุทูุจ ุจูุฌุงุญ
```

### 2. ุงุฎุชุจุงุฑ ุฅุนุฏุงุฏุงุช Admin:

```bash
# 1. ุณุฌู ุฏุฎูู ูู Admin
# 2. ุงุฐูุจ ูู Payment Settings
# 3. ุฌุฑุจ ุชูุนูู/ุชุนุทูู ุทุฑููุฉ ุฏูุน
# 4. ุฌุฑุจ ุฅุถุงูุฉ ููุงุชูุญ ููููุฉ
# โ ูุฌุจ ุฃู ุชุญูุธ ุงูุชุบููุฑุงุช
```

### 3. ุงุฎุชุจุงุฑ API ูุจุงุดุฑุฉ:

```bash
# ุฌูุจ ุทุฑู ุงูุฏูุน
curl http://localhost:4000/api/payments/methods

# ุฌูุจ ุฅุนุฏุงุฏุงุช ุงูุฏูุน (ูุญุชุงุฌ token)
curl -H "Authorization: Bearer YOUR_TOKEN" \
     http://localhost:4000/api/payments/settings
```

---

## ๐ ุญู ุงููุดุงูู ุงูุดุงุฆุนุฉ

### ุงููุดููุฉ: "ERR_CONNECTION_REFUSED"
**ุงูุญู:** ุชุฃูุฏ ุฃู Backend ุดุบุงู ุนูู ุงูุจูุฑุช 4000
```bash
cd backend
npm run dev
```

### ุงููุดููุฉ: "500 Internal Server Error"
**ุงูุญู:** 
1. ุชุฃูุฏ ูู MongoDB ุดุบุงู
2. ุชุฃูุฏ ูู ููู `.env` ุตุญูุญ
3. ุดุบู ุณูุฑูุจุช ุงูุชููุฆุฉ:
```bash
cd backend
npx ts-node init-payment-settings.ts
```

### ุงููุดููุฉ: "Payment methods not showing"
**ุงูุญู:** ุดุบู ุณูุฑูุจุช ุงูุชููุฆุฉ ูุฅูุดุงุก ุงูุจูุงูุงุช ุงูุฃูููุฉ

### ุงููุดููุฉ: "Admin can't access payment settings"
**ุงูุญู:** ุชุฃูุฏ ุฃูู ูุณุฌู ุฏุฎูู ูู Admin (role: ADMIN)

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุฃูุงู:**
   - ูุง ุชุดุงุฑู API Keys ุฃุจุฏุงู
   - ุงุณุชุฎุฏู HTTPS ูู ุงูุฅูุชุงุฌ
   - ุงุญูุธ ุงูููุงุชูุญ ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ

2. **ูุถุน ุงูุงุฎุชุจุงุฑ:**
   - ุงุณุชุฎุฏู Test Mode ูุจู ุงูุชูุนูู ุงููุนูู
   - ุฌุฑุจ ูู ุทุฑููุฉ ุฏูุน ุจูุจุงูุบ ุตุบูุฑุฉ ุฃููุงู

3. **Webhooks:**
   - ูู ุงูุฅูุชุงุฌุ ุณุฌู Webhook URLs ูู ููุญุฉ ุชุญูู ูู ุดุฑูุฉ
   - ุชุฃูุฏ ุฃู ุงูุณูุฑูุฑ ููุจู POST requests ูู ุงูุฎุงุฑุฌ

4. **ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
   - ุฌุฏูู `PaymentSettings` ูุญูุธ ุฅุนุฏุงุฏุงุช ูู ุทุฑููุฉ
   - ุฌุฏูู `Order` ูุญูุธ ุญุงูุฉ ุงูุฏูุน ููู ุทูุจ

---

## ๐ฏ ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑู)

### ูููุฒุงุช ุฅุถุงููุฉ ูููู ุฅุถุงูุชูุง:

1. **ูุธุงู ุงูููุจููุงุช:**
   - ุฎุตููุงุช ูุณุจุฉ ูุฆููุฉ
   - ุฎุตููุงุช ูุจูุบ ุซุงุจุช
   - ุดุฑูุท ุงูุงุณุชุฎุฏุงู

2. **ุชูุงุฑูุฑ ุงูุฏูุน:**
   - ุฅุญุตุงุฆูุงุช ุงููุจูุนุงุช
   - ุฃูุซุฑ ุทุฑู ุงูุฏูุน ุงุณุชุฎุฏุงูุงู
   - ูุนุฏู ูุฌุงุญ ุงูุฏูุน

3. **ุฅุดุนุงุฑุงุช ุงูุฏูุน:**
   - ุฅุดุนุงุฑ ููุนููู ุนูุฏ ูุฌุงุญ ุงูุฏูุน
   - ุฅุดุนุงุฑ ููู Admin ุนูุฏ ุทูุจ ุฌุฏูุฏ
   - SMS/Email notifications

4. **ุงุณุชุฑุฌุงุน ุงูุฃููุงู:**
   - ูุธุงู Refund
   - ุฅูุบุงุก ุงูุทูุจุงุช
   - ุงุณุชุฑุฌุงุน ุฌุฒุฆู

---

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดููุฉ:
1. ุชุญูู ูู logs ุงูู Backend
2. ุชุญูู ูู Console ูู ุงููุชุตูุญ
3. ุชุฃูุฏ ูู MongoDB ุดุบุงู
4. ุชุฃูุฏ ูู ุฌููุน ุงูููุงุชูุญ ุตุญูุญุฉ

---

**ุชู ุฅูุดุงุก ูุฐุง ุงูุฏููู ูู:** 27 ููููุจุฑ 2025
**ุงูุฅุตุฏุงุฑ:** 1.0.0
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู
